1、	父进程为读者
因为fork返回后会先执⾏行行⽗父进程，所以应该在⽗父进程开始执⾏行行时，先切换到⼦子进程进⾏行行写⼊入。
2、	dup中的进程竞争
dup的作用是复制文件描述符，使用一个可用范围内最小的文件描述符作为新的文件描述符。dup函数也不不是原⼦子性的，会被时钟中断打断，⽽而在未修改的dup函数中，先map了了fd，然后才map了data，如果在两步的中间发⽣生了了中断的话，就可能会出现竞争错误。
3、	原子操作
系统调⽤用在陷⼊入内核的时候，会关闭时钟中断，这样整个系统调⽤用过程就不不会被打断了了，所以是原⼦操作。
4、	解决进程竞争
因为pipe的pageref本来就是⼤于fd的，在unmap的时候，优先接触fd的映射，就会保证严格大于关系恒成立，即使被时钟中断打断，也不会发⽣生错误。dup同理。
5、	spawn中的进程共享
spawn函数是通过和文件系统交互，取得文件描述块，进而找到elf在硬盘中的位置，进而读取。两个进程在使用此共享内存空间之前，需要在进程地址空间与共享内存空间之间建立联系，即将共享内存空间挂载到进程中。


